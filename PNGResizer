from PIL import Image, ImageFilter
import tkinter as tk
from tkinter import filedialog

def resize_sharpen_and_smooth(input_path, output_path):
    with Image.open(input_path) as img:
        width, height = img.size
        
        # Use LANCZOS for high-quality resizing
        new_size = (width // 2, height // 2)
        
        # Resize the image using LANCZOS filter
        resized_img = img.resize(new_size, Image.LANCZOS)

        # Apply a slight Gaussian blur for smoothing
        smoothed_img = resized_img.filter(ImageFilter.GaussianBlur(radius=0.5))

        # Sharpen the image slightly after smoothing
        final_img = smoothed_img.filter(ImageFilter.SHARPEN)

        # Save the final image without metadata
        final_img.save(output_path, format="PNG", optimize=True)

    print(f"Processed image saved at {output_path}")

# Function to open file dialog and select PNG file
def select_file():
    root = tk.Tk()
    root.withdraw()  # Hide the main tkinter window
    file_path = filedialog.askopenfilename(
        title="Select a PNG file",
        filetypes=[("PNG files", "*.png")]
    )
    return file_path

# Function to select the save location
def select_save_location():
    root = tk.Tk()
    root.withdraw()  # Hide the main tkinter window
    save_path = filedialog.asksaveasfilename(
        title="Choose save location",
        defaultextension=".png",  # Default to PNG format
        filetypes=[("PNG files", "*.png")]
    )
    return save_path

# Main program
if __name__ == "__main__":
    selected_file = select_file()

    if selected_file:
        save_location = select_save_location()

        if save_location:
            resize_sharpen_and_smooth(selected_file, save_location)
        else:
            print("No save location selected!")
    else:
        print("No file selected!")
